{% extends "base.html" %}
{% load static %}
{% block content %}
<!-- content starts here -->

<div class="container-fluid">
    <div class="row">
        {% if user.is_authenticated %}
        {% for booking in booking_list %}
        <h3>
            <div class="col-12 col-md-6">Booking for: </div>
            <div class="col-12 col-md-6">{{ booking.booking_date }}</div>
        </h3>
        <a class="btn btn-info" href="{% url 'booking_detail' user.id booking.id %}">Booking Details</a>
        <div class="container text-left">
            <!-- add if statements to adjust cols for departures vs arrivals -->
            <div class="row row-cols-8 row-cols-sm-9 row-cols-xl-10" id="table-header">
                <div class="col">
                    <h3>Departing</h3>
                </div>
                <div class="col">
                    <h3>Arriving</h3>
                </div>
                <!-- hide airline name on large or smaller devices -->
                <div class="col d-none d-xl-block">
                    <h3>Airline</h3>
                </div>
                <!-- hide flight code on x-small devices -->
                <div class="col d-none d-sm-block">
                    <h3>Flight</h3>
                </div>
                <div class="col">
                    <h3>Departure Time</h3>
                </div>
                <div class="col">
                    <h3>Arrival Time</h3>
                </div>
                <div class="col">
                    <h3>Status</h3>
                </div>
            </div>
            <!-- Loop through the journeys, using only the journeys that match the current booking -->
            {% for journey in journey_list %}
            {% if journey.booking_id == booking %}
            <!-- now loop through the flights, and only display the flights that match the current journey -->
            {% for flight in flight_list %}
            {% if journey.flight_id == flight %}
            <div class="row row-cols-8 row-cols-sm-9 row-cols-xl-10
                            booking-row {% cycle 'table-row-odd' 'table-row-even' %}">
                <div class="col">{{ flight.departure_airport.city }}</div>
                <div class="col">{{ flight.arrival_airport.city }}</div>
                <!-- hide airline name on large or smaller devices -->
                <div class="col d-none d-xl-block">{{ flight.airline }}</div>
                <!-- hide flight code on x-small devices -->
                <div class="col d-none d-sm-block">{{ flight.flight_number }}</div>
                <div class="col d-block">{{ flight.expected_time|time:"H:i" }}</div>
                <div class="col">{{ flight.arrival_expected_time|time:"H:i" }}</div>
                <div class="col d-block">{{ flight.status }}</div>
                <!-- show expand button on large or smaller devices -->
                <div class="col d-block d-xl-none text-end">
                    <button class="btn btn-primary expand-btn" data-flight_id="expand-{{ flight.id }}"></button>
                </div>
            </div>
            <!-- plus button toggles this extra information row to be visible. -->
            <div class="row extra-flight-info" id="expand-{{ flight.id }}" style="display: none;">
                <!-- show airline name on large or smaller devices -->
                <div class="col d-block d-xl-none"><strong>Airline: </strong>{{ flight.airline }}</div>
                <!-- show flight code on x-small devices -->
                <div class="col d-block d-sm-none"><strong>Flight Number: </strong>{{ flight.flight_number }}</div>
            </div>
            <!-- end flights loop -->
            {% endif %}
            {% endfor %}
            <!-- Reset the cycle now that we are starting a new flights table, for the next journey -->
            {% resetcycle %}
            <!-- end journeys loop -->
            {% endif %}
            {% endfor %}
        </div>
        <!-- end bookings loop -->
        {% endfor %}
        {% else %}
        <p>Error: Couldn't access your bookings.</p>
        {% endif %}
    </div>
</div>

<!-- end of index.html -->
{% endblock content %}

{% block extras %}
<script src="{% static 'js/bookings.js' %}"></script>
<script src="{% static 'js/flight_timetable.js' %}"></script>
{% endblock extras %}